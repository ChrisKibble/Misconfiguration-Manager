<p align="center">
<a href="https://github.com/subat0mik/Misconfiguration-Manager">
  <img src="https://img.shields.io/endpoint?url=https%3A%2F%2Fraw.githubusercontent.com%2Fspecterops%2F.github%2Fmain%2Fconfig%2Fshield.json&style=flat"
      alt="Sponsored by SpecterOps"/>
</a>
<a href="https://join.slack.com/t/bloodhoundhq/shared_invite/zt-1tgq6ojd2-ixpx5nz9Wjtbhc3i8AVAWw">
    <img src="https://img.shields.io/badge/Slack-%23sccm-blueviolet?logo=slack" alt="Slack"/>
</a>
<a href="https://twitter.com/subat0mik">
    <img src="https://img.shields.io/twitter/follow/subat0mik?style=social"
      alt="@subat0mik_ on Twitter"/></a>
<a href="https://twitter.com/_Mayyhem">
    <img src="https://img.shields.io/twitter/follow/_Mayyhem?style=social"
      alt="@_Mayyhem on Twitter"/></a>
<a href="https://twitter.com/garrfoster">
    <img src="https://img.shields.io/twitter/follow/garrfoster?style=social"
      alt="@garrfoster on Twitter"/></a>

</p>

# Misconfiguration Manager
This repository serves as a central knowledge-base for all known Microsoft Configuration Manager (AKA MCM, ConfigMgr, Systems Center Configuration Manager, or SCCM) tradecraft and associated defensive and hardening guidance. Our goal is to help demystify SCCM tradecraft and simplify SCCM attack path management for defenders while also educating offensive professionals on this nebulous attack surface. Designed to go beyond the static-nature of whitepapers, this living repository not only documents SpecterOps' real-world application of misconfigurations but also encourages ongoing contributions from the community to enhance its relevance and utility.

At SpecterOps, we've leveraged many misconfigurations highlighted in this repository in real-world environments while some represent experimental and exploratory research projects proved out in a lab environment.

We've curated this repository to raise awareness of the rapidly evolving MCM threat landscape, drawing inspiration from the MITRE ATT&CK framework, with a few deviations. We were also strongly influenced by Push Security's [SaaS attack techniques matrix](https://github.com/pushsecurity/saas-attacks/tree/main). Our approach extends beyond cataloging the tactics of known adversaries to include contributions from the realm of penetration testing, red team operations, and security research. We openly invite and value the submission of both proven and exploratory MCM-focused attack techniques and defensive strategies.

## Taxonomy Overview

### CRED
Techniques coded with a CRED moniker primarily abuse credential access. CRED techniques are the most common we've seen and sometimes lead do direct hierarchy or site takeover or domain compromise.

### ELEVATE 
Techniques coded with an ELEVATE moniker can be used for either local or domain privilege escalation. In some cases, these can be chained with other techniques for a hierarchy or site takeover primitive.

### EXEC
Techniques coded with an EXEC moniker can be used to execute commands, scripts, code, etc. on a remote target through MCM's builtin functionality

### RECON
Techniques coded with a RECON moniker relate to either performing reconnaissance against MCM infrastructure or using MCM to conduct further reconnaissance.

### TAKEOVER
Techniques coded with a TAKEOVER moniker describe the various steps necessary to compromise an MCM hierarchy or site.

### PREVENT
Defensive strategies coded with a PREVENT moniker describe configuration changes to mitigate one or more aspects of an offensive technique. In some cases, multiple PREVENT strategies may be needed to fully mitigate an offensive technique.

**NOTE:** We strongly recommend proper and thorough testing of any changes before configuring them in a production environment. The authors and contributors of this repository are not responsible for any breaking changes. Use as a guide at your own risk.

### DETECT
Defensive strategies coded with a DETECT moniker describe strategies for detecting offensive techniques. In some cases, multiple DETECT strategies may be required for a stronger detection.

### CANARY
Defensive strategies coded with a CANARY moniker describe deception strategies that could be used to deceive adversaries in tripping a high-fidelity detection.

## SCCM Attacks Matrix
| Initial Access                                                                  | Execution                                                                          | Persistence                                                                        | Privilege Escalation                                                                              | Defense Evasion                                                               | Credential Access                                                                             | Discovery                                                                     | Lateral Movement                                                                                  | Collection	                                                              | Command and Control                                                     | Exfiltration                                                              |
|:---:                                                                            |:---:	                                                                           |:---:                                                                               |:---:	                                                                                            |:---:                                                                          |:---:	                                                                                        |:---:	                                                                        |:---:	                                                                                            |:---:	                                                                      |:---:	                                                                |:---:	                                                                    |
| [PXE Creds](./attack-techniques/CRED/CRED-1/cred-1_description.md)              | [App Deployment](./attack-techniques/EXEC/EXEC-1/exec-1_description.md)            | [App Deployment](./attack-techniques/EXEC/EXEC-1/exec-1_description.md)            | [Site Server Relay](./attack-techniques/ELEVATE/ELEVATE-1/ELEVATE-1_description.md)               | [App Deployment](./attack-techniques/EXEC/EXEC-1/exec-1_description.md)       | [PXE Credentials](./attack-techniques/CRED/CRED-1/cred-1_description.md)                      | [LDAP Enumeration](./attack-techniques/RECON/RECON-1/recon-1_description.md)  | [Site Database Relay (MSSQL)](./attack-techniques/TAKEOVER/TAKEOVER-1/takeover-1_description.md)  | [CMPivot](./attack-techniques/RECON/RECON-4/recon-4_description.md)         |   	                                                                    | [CMPivot](./attack-techniques/RECON/RECON-4/recon-4_description.md)       |
|   	                                                                          | [Script Deployment](./attack-techniques/EXEC/EXEC-2/exec-2_description.md)         | [Script Deployment](./attack-techniques/EXEC/EXEC-2/exec-2_description.md)         | [Client Push Relay](./attack-techniques/ELEVATE/ELEVATE-2/ELEVATE-2_description.md)               | [Script Deployment](./attack-techniques/EXEC/EXEC-2/exec-2_description.md)    | [Policy Request Credentials](./attack-techniques/CRED/CRED-2/cred-2_description.md)           | [SMB Enumeration](./attack-techniques/RECON/RECON-2/recon-2_description.md)   | [AdminService Relay](./attack-techniques/TAKEOVER/TAKEOVER-2/takeover-2_description.md)           |                                                                             |   	                                                                    |   	                                                                    |
|   	                                                                          |   	                                                                               | [ADCS Relay](./attack-techniques/TAKEOVER/TAKEOVER-3/takeover-3_description.md)    | [Site Database Relay (MSSQL)](./attack-techniques/TAKEOVER/TAKEOVER-1/takeover-1_description.md)  |   	                                                                        | [DPAPI Credentials](./attack-techniques/CRED/CRED-3/cred-3_description.md)                    | [HTTP Enumeration](./attack-techniques/RECON/RECON-3/recon-3_description.md)  | [Active-Passive Relay](./attack-techniques/TAKEOVER/TAKEOVER-7/takeover-7_description.md)         |                                                                             |   	                                                                    |   	                                                                    |
|   	                                                                          |   	                                                                               | [LDAP Relay](./attack-techniques/TAKEOVER/TAKEOVER-8/takeover-8_description.md)    | [LDAP Relay](./attack-techniques/TAKEOVER/TAKEOVER-8/takeover-8_description.md)                   |   	                                                                        | [Legacy Credentials](./attack-techniques/CRED/CRED-4/cred-4_description.md)                   | [CMPivot](./attack-techniques/RECON/RECON-4/recon-4_description.md)           | [App Deployment](./attack-techniques/EXEC/EXEC-1/exec-1_description.md)                           |                                                                             |   	                                                                    |   	                                                                    |
|   	                                                                          |   	                                                                               |   	                                                                                | [Site Database Relay (SMB)](./attack-techniques/TAKEOVER/TAKEOVER-2/takeover-2_description.md)    |   	                                                                        | [Site Database Credentials](./attack-techniques/CRED/CRED-5/cred-5_description.md)            |   	                                                                        | [Script Deployment](./attack-techniques/EXEC/EXEC-2/exec-2_description.md)                        |   	                                                                      |   	                                                                    |   	                                                                    |
|   	                                                                          |   	                                                                               |   	                                                                                | [ADCS Relay](./attack-techniques/TAKEOVER/TAKEOVER-3/takeover-3_description.md)                   |   	                                                                        |   	                                                                                        |   	                                                                        | [Site Server Relay](./attack-techniques/ELEVATE/ELEVATE-1/ELEVATE-1_description%20copy.md)        |   	                                                                      |   	                                                                    |   	                                                                    |
|   	                                                                          |   	                                                                               |   	                                                                                | [CAS-Origin PSS Relay](./attack-techniques/TAKEOVER/TAKEOVER-4/takeover-4_description.md)         |   	                                                                        |   	                                                                                        |   	                                                                        | [Client Push Relay](./attack-techniques/ELEVATE/ELEVATE-2/ELEVATE-2_description.md)               |   	                                                                      |   	                                                                    |   	                                                                    |
|   	                                                                          |   	                                                                               |   	                                                                                | [AdminService Relay](./attack-techniques/TAKEOVER/TAKEOVER-5/takeover-5_description.md)           |   	                                                                        |   	                                                                                        |   	                                                                        | [CAS-Origin PSS Relay](./attack-techniques/TAKEOVER/TAKEOVER-4/takeover-4_description.md)         |   	                                                                      |   	                                                                    |   	                                                                    |
|   	                                                                          |   	                                                                               |   	                                                                                | [SMS Provider Relay](./attack-techniques/TAKEOVER/TAKEOVER-6/takeover-6_description.md)           |   	                                                                        |   	                                                                                        |   	                                                                        | [AdminService Relay](./attack-techniques/TAKEOVER/TAKEOVER-5/takeover-5_description.md)  	        |   	                                                                      |   	                                                                    |   	                                                                    |
|                                                                                 |                                                                                    |                                                                                    | [Active-Passive Relay](./attack-techniques/TAKEOVER/TAKEOVER-7/takeover-7_description.md)         |                                                                               |                                                                                               |                                                                               | [SMS Provider Relay](./attack-techniques/TAKEOVER/TAKEOVER-6/takeover-6_description.md)           |                                                                             |                                                                         |                                                                           |
|                                                                                 |                                                                                    |                                                                                    |                                                                                                   |                                                                               |                                                                                               |                                                                               |                                                                                                   |                                                                             |                                                                         |                                                                           |
|                                                                                 |                                                                                    |                                                                                    |                                                                                                   |                                                                               |                                                                                               |                                                                               |                                                                                                   |                                                                             |                                                                         |                                                                           |


## SCCM Attack and Defense Matrix
|                      | CRED&#x2011;1        | CRED&#x2011;2         | CRED&#x2011;3        | CRED&#x2011;4       | CRED&#x2011;5        | ELEVATE&#x2011;1     | EXEC&#x2011;1        | EXEC&#x2011;2        | RECON&#x2011;1       | RECON&#x2011;2       | RECON&#x2011;3       | RECON&#x2011;4       | TAKEOVER&#x2011;1    | TAKEOVER&#x2011;2    | TAKEOVER&#x2011;3    | TAKEOVER&#x2011;4    | TAKEOVER&#x2011;5    |
|:---------------------|:--------------------:|:---------------------:|:--------------------:|:-------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|
| **PREVENT&#x2011;1** |                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      | 
| **PREVENT&#x2011;2** |                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      | X                    |                      |                      |                      |                      |
| **PREVENT&#x2011;3** | X                    | X                     | X                    | X                   |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;4** |                      | X                     | X                    | X                   |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;5** |                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      | 
| **PREVENT&#x2011;6** | X                    |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      | 
| **PREVENT&#x2011;7** | X                    |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;8** |                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;9** |                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      | X                    |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;10**|                      | X                     | X                    | X                   |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;11**|                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;12**|                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      | X                    |                      |                      |                      |                      |
| **PREVENT&#x2011;13**|                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;14**|                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      | X                    |                      |                      |                      |                      |
| **PREVENT&#x2011;15**|                      |                       |                      | X                   |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;16**|                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;17**|                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;18**|                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;19**|                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;20**|                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;21**| X                    |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;22**|                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
| **PREVENT&#x2011;23**|                      |                       |                      |                     |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |                      |
